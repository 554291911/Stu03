<@m.header/> <@m.body />
<div class="row">
	<div class="col-md-12">
		<div class="portlet box blue">
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-gift"></i>应用信息
				</div>
				<div class="actions">
					<a href="javascript:;"
						class="btn btn-circle btn-default btn-sm btn-icon-only fullscreen"
						data-original-title="" title="全屏"></a>
				</div>
			</div>
			<div class="portlet-body">
				<div class="row">
					<div class="col-md-4">
						<div class="portlet light bordered">
							<div class="portlet-title">
								<div class="caption font-green-sharp">
									<i class="icon-speech font-green-sharp"></i> <span
										class="caption-subject bold uppercase">导航栏</span> <span
										class="caption-helper"></span>
								</div>
								<div class="actions">
									<a data-toggle="modal" href="#tjdh"
										class="btn btn-circle btn-default btn-sm"> <i
										class="fa fa-plus"></i>添加导航
									</a>
								</div>
							</div>
							<div class="portlet-body">
								<table class="table table-striped table-bordered table-hover"
									id="sample_1">
									<thead>
										<tr>
											<th hidden="true">ID</th>
											<th>序号</th>
											<th>导航栏</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div class="col-md-8">
						<div class="portlet light bordered">
							<div class="portlet-title">
								<div class="caption font-green-sharp">
									<i class="icon-speech font-green-sharp"></i> <span
										class="caption-subject bold uppercase" id="yy">所有</span> <span
										class="caption-helper">功能</span>
								</div>
								<div class="actions">
									<a  data-toggle="modal" href="#tjgnm" id="tjgn"
										class="btn btn-circle btn-default btn-sm disabled"> <i
										class="fa fa-plus"></i>添加功能
									</a>
								</div>
							</div>
							<div class="portlet-body">
								<table class="table table-striped table-bordered table-hover"
									id="sample_2">
									<thead>
										<tr>
											<th hidden="true">ID</th>
											<th>序号</th>
											<th>导航栏</th>
											<th>功能名称</th>
											<th>主页URI</th>
											<th>权限URI</th>
											<th>描述</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="tjdh" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">添加导航</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">序号</label>
									<div class="col-md-7">
										<input id="sorder" type="number"
											class="form-control input-circle" placeholder="请输入导航栏显示的顺序号.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">导航栏名称</label>
									<div class="col-md-7">
										<input id="name" type="text" class="form-control input-circle"
											placeholder="请输入导航栏名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="addNavbar();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="xgdh" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">修改导航</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">序号</label>
									<div class="col-md-7">
										<input id="xsorder" type="number"
											class="form-control input-circle" placeholder="请输入导航栏显示的顺序号.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">导航栏名称</label>
									<div class="col-md-7">
										<input id="xname" type="text" class="form-control input-circle"
											placeholder="请输入导航栏名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="upNavbar();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="tjgnm" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">添加功能</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">序号</label>
									<div class="col-md-7">
										<input id="sorderf" type="number" class="form-control input-circle"
											placeholder="请输入功能顺序号">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">功能名称</label>
									<div class="col-md-7">
										<input id="namef" type="text" class="form-control input-circle"
											placeholder="请输入功能名称">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">主页URI</label>
									<div class="col-md-7">
										<input id="homepage" type="text" class="form-control input-circle"
											placeholder="请输入主要URI,例如:/xxx/index.do">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">权限URI</label>
									<div class="col-md-7">
										<input id="uri" type="text" class="form-control input-circle"
											placeholder="请输入权限URI,例如：/xxx/**">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">功能描述</label>
									<div class="col-md-7">
										<input id="description" type="text" class="form-control input-circle"
											placeholder="请输入功能描述">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="addFun();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="xggn" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">修改功能</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">序号</label>
									<div class="col-md-7">
										<input id="xfsorder" type="number" class="form-control input-circle"
											placeholder="请输入功能顺序号">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">功能名称</label>
									<div class="col-md-7">
										<input id="xfname" type="text" class="form-control input-circle"
											placeholder="请输入功能名称">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">主页URI</label>
									<div class="col-md-7">
										<input id="xfhomepage" type="text" class="form-control input-circle"
											placeholder="请输入主要URI,例如:/xxx/index.do">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">权限URI</label>
									<div class="col-md-7">
										<input id="xfuri" type="text" class="form-control input-circle"
											placeholder="请输入权限URI,例如：/xxx/**">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">功能描述</label>
									<div class="col-md-7">
										<input id="xfdescription" type="text" class="form-control input-circle"
											placeholder="请输入功能描述">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="upFun();">保存</button>
				</div>
			</div>
		</div>
	</div>
</div>
<@m.footer/>
<script type="text/javascript">
	var nid = "";
	var fid = "";
	var t=null;
	var oTable2;
	var oTable1;
	function initTable() {
		oTable1 = $('#sample_1')
				.DataTable(
						{
							"language" : {
								"aria" : {
									"sortAscending" : ": 升序排序",
									"sortDescending" : ": 降序排序"
								},
								"emptyTable" : "无数据",
								"info" : "",
								"infoEmpty" : "没有数据",
								"infoFiltered" : "(共 _MAX_ 条 )",
								"lengthMenu" : "显示 _MENU_条数据",
								"search" : "搜索:",
								"zeroRecords" : "未找到匹配的数据"
							},
							"order" : [ [ 0, 'asc' ] ],
							"lengthMenu" : [ [ 5, 10, 15, 20, -1 ],
									[ 5, 10, 15, 20, "全部" ] // change per page values here
							],
							"pageLength" : 10,
							"dom" : "<'row' <'col-md-12'>><'row'<'col-md-6 col-sm-12'><'col-md-6 col-sm-12'>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'><'col-md-7 col-sm-12'>>", // horizobtal scrollable datatable
							"ajax" : "<@m.path/>/function/loadNavbar.do",
							"columns" : [ {
								"data" : "s_order"
							}, {
								"data" : "nvaname"
							}, {
								"data" : "cz"
							} ]
						});
		oTable2 = $('#sample_2')
				.DataTable(
						{
							"language" : {
								"aria" : {
									"sortAscending" : ": 升序排序",
									"sortDescending" : ": 降序排序"
								},
								"emptyTable" : "无数据",
								"info" : "显示 _START_ 到 _END_ 共 _TOTAL_ 条数据",
								"infoEmpty" : "没有数据",
								"infoFiltered" : "(共 _MAX_ 条 )",
								"lengthMenu" : "显示 _MENU_条数据",
								"search" : "搜索:",
								"zeroRecords" : "未找到匹配的数据"
							},
							"order" : [ [ 0, 'asc' ] ],
							"lengthMenu" : [ [ 5, 10, 15, 20, -1 ],
									[ 5, 10, 15, 20, "全部" ] // change per page values here
							],
							"pageLength" : 10,
							"dom" : "<'row' <'col-md-12'>><'row'<'col-md-6 col-sm-12'><'col-md-6 col-sm-12'>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'><'col-md-7 col-sm-12'>>",
							"ajax" : "<@m.path/>/function/loadFunction.do",
							"columns" : [ {
								"data" : "sorder"
							}, {
								"data" : "navbar"
							},{
								"data" : "name"
							}, {
								"data" : "homepage"
							}, {
								"data" : "uri"
							}, {
								"data" : "description"
							}, {
								"data" : "cz"
							} ]
						});
	}
	$(function() {
		initTable();
		$('#sample_1 tbody').on('click', 'tr', function() {
			var data = $('#sample_1').DataTable().row(this).data();
			if (t != this) {
				nid = data.id;
				$("#yy").html(data.nvaname);
				$("#tjgn").removeClass("disabled");
				oTable2.ajax.url("<@m.path/>/function/loadFunction.do?nid="+nid).load();
			}
			if (t == null) {
				$(this).addClass('active');
				t = this;
			} else {
				if (t != this) {
					$(t).removeClass('active');
					$(this).addClass('active');
					t = this;
				}
			}
		});
	});
	function delf(id) {
		bootbox.confirm("您确定要删除该应用吗?", function(result) {
			if (result == true) {
				$.post("delf.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("操作成功!", "成功");
						oTable2.ajax.reload();
					} else {
						toastr.error("操作失败!", "错误");
						bootbox.alert("操作失败！信息：" + data);
					}
				}, "text");
			}
		});
	}
	function deln(id) {
		bootbox.confirm("系统会删除该导航栏下的所有应用，您确定要继续删除该导航栏吗?", function(result) {
			if (result == true) {
				$.post("deln.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("操作成功!", "成功");
						oTable1.ajax.reload();
						oTable2.ajax.reload();
					} else {
						toastr.error("操作失败!", "错误");
						bootbox.alert("操作失败！信息：" + data);
					}
				}, "text");
			}
		});
	}
	function updn(id) {
		openBlock();
		$.post("getNavbar.do", {
			"id" : id
		}, function(data) {
			if (data != "error") {
				closeBlock();
				nid = id;
				$("#xsorder").val(data.sorder);
				$("#xname").val(data.name);
				$('#xgdh').modal('show');
			} else {
				bootbox.alert("操作失败,请稍后再试!");
			}
		}, "json");
	}
	function updf(id) {
		openBlock();
		$.post("getFunction.do", {
			"id" : id
		}, function(data) {
			if (data != "error") {
				closeBlock();
				fid = id;
				$("#xfsorder").val(data.sorder);
				$("#xfname").val(data.name);
				$("#xfhomepage").val(data.homepage);
				$("#xfuri").val(data.uri);
				$("#xfdescription").val(data.description);
				$('#xggn').modal('show');
			} else {
				bootbox.alert("操作失败,请稍后再试!");
			}
		}, "json");
	}
	function addNavbar() {
		$('#tjdh').modal('hide');
		openBlock();
		var sorder = $("#sorder").val();
		var name = $("#name").val();
		$.post("addNavbar.do", {
			"sorder" : sorder,
			"name" : name
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable1.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function addFun() {
		$('#tjgnm').modal('hide');
		openBlock();
		var sorder = $("#sorderf").val();
		var name = $("#namef").val();
		var homepage = $("#homepage").val();
		var uri = $("#uri").val();
		var description = $("#description").val();
		$.post("addFun.do", {
			"sorder" : sorder,
			"name" : name,
			"homepage":homepage,
			"uri":uri,
			"description":description,
			"nid":nid
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable2.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	
	function upNavbar() {
		$('#xgdh').modal('hide');
		openBlock();
		var name = $("#xname").val();
		var sorder = $("#xsorder").val();
		$.post("upNavbar.do", {
			"id" : nid,
			"name" : name,
			"sorder" : sorder
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable1.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function upFun() {
		$('#xggn').modal('hide');
		openBlock();
		var sorder = $("#xfsorder").val();
		var name = $("#xfname").val();
		var homepage = $("#xfhomepage").val();
		var uri = $("#xfuri").val();
		var description = $("#xfdescription").val();
		$.post("upFunction.do", {
			"id" : fid,
			"name" : name,
			"sorder" : sorder,
			"homepage":homepage,
			"uri":uri,
			"description":description
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable2.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
</script>
<@m.end/>
