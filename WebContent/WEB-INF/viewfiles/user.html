<@m.header/> <@m.body />
<div class="row">
	<div class="col-md-12">
		<div class="portlet box blue">
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-gift"></i>用户信息
				</div>
				<div class="actions">
					<a data-toggle="modal" href="#adduser"
						class="btn  btn-default btn-sm"> <i class="fa fa-plus"></i>增加用户
					</a> <a href="javascript:;" onclick="sear();"
						class="btn btn-circle btn-default" title="点击打开高级搜索面板"> <i
						class="fa fa-search" title="点击打开高级搜索面板"></i>高级搜索
					</a> <a href="javascript:;"
						class="btn btn-circle btn-default btn-sm btn-icon-only fullscreen"
						data-original-title="" title="全屏"></a>
				</div>
			</div>
			<div class="portlet-body">
				<div id="se" hidden="true">
					<div class="row">
						<div class="col-md-6">
							<div
								class="form-group form-md-line-input  form-md-floating-label">
								<div class="input-icon">
									<input type="text" class="form-control" id="form_control_1">
									<label for="form_control_1">请输入搜索内容...</label> <span
										class="help-block">您可以连续输入多个关键字,关键字之间用空格分开</span> <i
										class="fa fa-search"></i>
								</div>
							</div>
						</div>
					</div>
				</div>
				<table class="table table-striped table-bordered table-hover" id="sample_1">
					<thead>
						<tr>
							<th hidden="true">ID</th>
							<th>账号</th>
							<th>姓名</th>
							<th>email</th>
							<th>电话</th>
							<th>学院</th>
							<th>角色</th>
							<th>状态</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="modal fade" id="adduser" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">添加用户</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">账号</label>
									<div class="col-md-7">
										<input id="username" type="text"  class="form-control input-circle"
											placeholder="请输入账号.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">姓名</label>
									<div class="col-md-7">
										<input id="name" type="text" class="form-control input-circle"
											placeholder="请输入用户姓名.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">学院</label>
									<div class="col-md-7">
										<select class="form-control input-circle" id="college">
													<option value="0"></option>
													<#list college as co>
        												<option value="${co.id}" >${co.name}</option>
													</#list> 
										</select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">Email</label>
									<div class="col-md-7">
										<input id="email" type="email" class="form-control input-circle"
											placeholder="请输入Email地址.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">电话</label>
									<div class="col-md-7">
										<input id="phone" type="tel" class="form-control input-circle"
											placeholder="请输入电话号码.">
									</div>
								</div>
								<div class="form-group">
									<div class="col-md-7 col-md-offset-3" style="color:red;">
										说明:用户添加成功后,初始密码是:123456
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="adduser();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="addroles" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">选择角色</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">角色</label>
									<div class="col-md-7">
										<select class="form-control" id="roles">
													<option value="0"></option>
													<#list roles as li>
        												<option value="${li.id}">${li.name}</option>
													</#list> 
										</select>
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="addroles();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="editeuser" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">修改用户</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">账号</label>
									<div class="col-md-7">
										<input id="eusername" type="text"  class="form-control input-circle"
											placeholder="请输入账号." disabled="disabled">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">姓名</label>
									<div class="col-md-7">
										<input id="ename" type="text" class="form-control input-circle"
											placeholder="请输入用户姓名.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">学院</label>
									<div class="col-md-7">
										<select class="form-control input-circle" id="ecollege">
													<option id="a"></option>
													<#list college as co>
        												<option  value="${co.id}">${co.name}</option>
													</#list> 
										</select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">Email</label>
									<div class="col-md-7">
										<input id="eemail" type="email" class="form-control input-circle"
											placeholder="请输入Email地址.">
									</div>
								</div>
								<div class="form-group">
									<label class="col-md-3 control-label">电话</label>
									<div class="col-md-7">
										<input id="ephone" type="tel" class="form-control input-circle"
											placeholder="请输入电话号码.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="editeuser();">保存</button>
				</div>
			</div>
		</div>
	</div>
</div>
<@m.footer/>
<script type="text/javascript">
	var userid="";
	var table = $('#sample_1');
	var oTable;
	function initTable1() {
		oTable = table
				.DataTable({
					"language" : {
						"aria" : {
							"sortAscending" : ": 升序排序",
							"sortDescending" : ": 降序排序"
						},
						"emptyTable" : "无数据",
						"info" : "显示 _START_ 到 _END_ 共 _TOTAL_ 条数据",
						"infoEmpty" : "没有数据",
						"infoFiltered" : "(共 _MAX_ 条 )",
						"lengthMenu" : "显示 _MENU_条数据",
						"search" : "搜索:",
						"zeroRecords" : "未找到匹配的数据"
					},
					"order" : [ [ 0, 'asc' ] ],
					"lengthMenu" : [ [ 5, 10, 15, 20, -1 ],
							[ 5, 10, 15, 20, "全部" ] // change per page values here
					],
					"pageLength" : 10,
					"dom" : "<'row' <'col-md-12'>><'row'<'col-md-6 col-sm-12'l><'col-md-6 col-sm-12'>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'i><'col-md-7 col-sm-12'p>>", // horizobtal scrollable datatable
					"ajax" : "<@m.path/>/user/load.do",
					"columns" : [ {
						"data" : "username"
					}, {
						"data" : "name"
					}, {
						"data" : "email"
					}, {
						"data" : "phone"
					}, {
						"data" : "college"
					}, {
						"data" : "roles"
					}, {
						"data" : "zt"
					}, {
						"data" : "cz"
					} ]
				});
	}
	$(function() {
		initTable1();
		$('#form_control_1').on(
				'keyup click',
				function() {
					$('#sample_1').DataTable().search($('#form_control_1').val(), true,
							true).draw();
				});
	});
	function del(id) {
		bootbox.confirm("您确定要删除该用户吗?", function(result) {
			if (result == true) {
				$.post("del.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("操作成功!", "成功");
						oTable.ajax.reload();
					} else {
						toastr.error("操作失败!", "错误");
						bootbox.alert("操作失败！信息：" + data);
					}
				}, "text");
			}
		});
	}
	function upd(id) {
		openBlock();
		$.post("getUser.do", {
			"id" : id
		}, function(data) {
			if (data != "error") {
				closeBlock();
				userid=id;
				$("#eusername").val(data.username);
				$("#ename").val(data.name);
				$("#eemail").val(data.email);
				$("#ephone").val(data.phone);
				$("#a").text(data.college.name);
				$("#a").val(data,college.id);
				$('#editeuser').modal('show');
			} else {
				bootbox.alert("操作失败,请稍后再试!");
			}
		}, "json");
	}
	function paw(id) {
		bootbox.confirm("重置后密码将修改为:123456,您确定要重置该用户的密码吗?", function(result) {
			if (result == true) {
				$.post("paw.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("操作成功!", "成功");
						oTable.ajax.reload();
					} else {
						toastr.error("操作失败!", "错误");
						bootbox.alert("操作失败！信息：" + data);
					}
				}, "text");
			}
		});
	}
	function zt(id, z) {
		$.post("zt.do", {
			"zt" : z,
			"id" : id
		}, function(data) {
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function adduser() {
		$('#adduser').modal('hide');
		openBlock();
		var username = $("#username").val();
		var name= $("#name").val();
		var email = $("#email").val();
		var phone =$("#phone").val();
		var collegeid =  $("#college").val();
		$.post("adduser.do", {
			"username" : username,
			"name" : name,
			"email" : email,
			"phone" : phone,
			"collegeid" : collegeid
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function editeuser() {
		$('#editeuser').modal('hide');
		openBlock();
		var name= $("#ename").val();
		var email = $("#eemail").val();
		var phone =$("#ephone").val();
		var collegeid =$("#ecollege").val(); 
		$.post("editeuser.do", {
			"id":	userid,
			"name" : name,
			"email" : email,
			"phone" : phone,
			"collegeid" : collegeid
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function roles(id){
		userid=id;
		$('#addroles').modal('show');
	}
	function addroles(){
		$('#addroles').modal('hide');
		openBlock();
		var rolesid = $("#roles").val();
		$.post("addroles.do", {
			"userid" : userid,
			"rolesid" : rolesid
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function sear() {
		if ($("#se").is(":hidden")) {
			$("#se").show(); //如果元素为隐藏,则将它显现
		} else {
			$("#se").hide(); //如果元素为显现,则将其隐藏
		}
	}
</script>
<@m.end/>
