<@m.header/> <@m.body />
<div class="row">
	<div class="col-md-12">
		<div class="portlet box blue">
			<div class="portlet-title">
				<div class="caption">
					<i class="fa fa-gift"></i>学院信息
				</div>
				<div class="actions">
					<a data-toggle="modal" href="#addcollege"
						class="btn  btn-default btn-sm"> <i class="fa fa-plus"></i>增加学院
					</a> <a href="javascript:;"
						class="btn btn-circle btn-default btn-sm btn-icon-only fullscreen"
						data-original-title="" title="全屏"></a>
				</div>
			</div>
			<div class="portlet-body">
				<div class="row">
					<div class="col-md-6">
						<table class="table table-striped table-bordered table-hover"
							id="sample_1">
							<thead>
								<tr>
									<th>学院名称</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
					<div class="col-md-6">
						<div class="portlet light bordered">
							<div class="portlet-title">
								<div class="caption font-green-sharp">
									<i class="icon-speech font-green-sharp"></i> <span
										class="caption-subject bold uppercase" id="yy">所有</span> <span
										class="caption-helper">专业</span>
								</div>
								<div class="actions">
									<a  data-toggle="modal" href="#addMajor" id="tjzy"
										class="btn btn-circle btn-default btn-sm disabled"> <i
										class="fa fa-plus"></i>添加专业
									</a>
								</div>
							</div>
							<div class="portlet-body">
								<table class="table table-striped table-bordered table-hover"
									id="sample_2">
									<thead>
										<tr>
											<th>学院</th>
											<th>专业</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="addcollege" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">添加学院信息</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">学院名称</label>
									<div class="col-md-7">
										<input id="name" type="text" class="form-control input-circle"
											placeholder="请输入学院名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="addcollege();">保存</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="editecollege" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">修改学院信息</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">学院名称</label>
									<div class="col-md-7">
										<input id="ename" type="text"
											class="form-control input-circle" placeholder="请输入学院名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="editcollege();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="addMajor" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">添加专业</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">专业名称</label>
									<div class="col-md-7">
										<input id="mname" type="text" class="form-control input-circle"
											placeholder="请输入专业名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="addmajor();">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="updMajor" tabindex="-1" role="basic"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true"></button>
					<h4 class="modal-title">修改专业</h4>
				</div>
				<div class="modal-body">
					<div class="portlet-body form">
						<!-- BEGIN FORM-->
						<form action="#" class="form-horizontal">
							<div class="form-body">
								<div class="form-group">
									<label class="col-md-3 control-label">专业名称</label>
									<div class="col-md-7">
										<input id="updmname" type="text" class="form-control input-circle"
											placeholder="请输入专业名称.">
									</div>
								</div>
							</div>
						</form>
						<!-- END FORM-->
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn default" data-dismiss="modal">取消</button>
					<button type="button" class="btn blue" onclick="updSmajor();">保存</button>
				</div>
			</div>
		</div>
	</div>
	
</div>
<@m.footer/>
<script type="text/javascript">
	var major="";
	var t = null;
	var ids=[];
	var collegeid = "";
	var majorid = "";
	var oTable1;
	var oTable2;
	function initTable() {
		oTable1 = $('#sample_1').DataTable({
					"language" : {
						"aria" : {
							"sortAscending" : ": 升序排序",
							"sortDescending" : ": 降序排序"
						},
						"emptyTable" : "无数据",
						"info" : "显示 _START_ 到 _END_ 共 _TOTAL_ 条数据",
						"infoEmpty" : "没有数据",
						"infoFiltered" : "(共 _MAX_ 条 )",
						"lengthMenu" : "显示 _MENU_条数据",
						"search" : "搜索:",
						"zeroRecords" : "未找到匹配的数据"
					},
					"order" : [ [ 0, 'asc' ] ],
					"lengthMenu" : [ [ 5, 10, 15, 20, -1 ],
							[ 5, 10, 15, 20, "全部" ] // change per page values here
					],
					"pageLength" : 100,
					"dom" : "<'row' <'col-md-12'>><'row'<'col-md-6 col-sm-12'><'col-md-6 col-sm-12'>><'table-scrollable't><'row'<'col-md-5 col-sm-12'><'col-md-7 col-sm-12'>>",
					"ajax" : "<@m.path/>/college/load.do",

					"columns" : [ {
						"data" : "name",
						"orderable" : true
					}, {
						"data" : "cz",
						"orderable" : false
					} ]
				});
		oTable2 = $('#sample_2').DataTable(
				{
					"language" : {
						"aria" : {
							"sortAscending" : ": 升序排序",
							"sortDescending" : ": 降序排序"
						},
						"emptyTable" : "无数据",
						"info" : "显示 _START_ 到 _END_ 共 _TOTAL_ 条数据",
						"infoEmpty" : "没有数据",
						"infoFiltered" : "(共 _MAX_ 条 )",
						"lengthMenu" : "显示 _MENU_条数据",
						"search" : "搜索:",
						"zeroRecords" : "未找到匹配的数据"
					},
					"order" : [ [ 0, 'asc' ] ],
					"lengthMenu" : [ [ 5, 10, 15, 20, -1 ],
							[ 5, 10, 15, 20, "全部" ] // change per page values here
					],
					"pageLength" : 10,
					"dom" : "<'row' <'col-md-12'>><'row'<'col-md-6 col-sm-12'><'col-md-6 col-sm-12'>r><'table-scrollable't><'row'<'col-md-5 col-sm-12'><'col-md-7 col-sm-12'>>",
					"ajax" : "<@m.path/>/college/loadMajor.do",
					"columns" : [{
						"data" : "college"
					},{
						"data" : "major"
					},{
						"data" : "cz"
					}]
				});
	}
	
	
	$(function() {
		initTable();
		$('#sample_1 tbody').on('click', 'tr', function() {
			var data = $('#sample_1').DataTable().row(this).data();
			if (t != this) {
				collegeid = data.id;
				$("#yy").html(data.name);
				$("#tjzy").removeClass("disabled");
				oTable2.ajax.url("<@m.path/>/college/getMajor.do?id="+collegeid).load();
			}
			if (t == null) {
				$(this).addClass('active');
				t = this;
			} else {
				if (t != this) {
					$(t).removeClass('active');
					$(this).addClass('active');
					t = this;
				}
			}
		});
	});
	function addcollege() {
		$('#addcollege').modal('hide');
		var name = $("#name").val();
		openBlock();
		$.post("addcollege.do", {
			"id" : collegeid,
			"name" : name
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable1.ajax.reload();
				$("#name").val("");
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}

	function delCollage(id) {
		bootbox.confirm("您确定要删除该学院吗?", function(result) {
			if (result == true) {
				$.post("del.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("删除成功!", "成功");
						oTable1.ajax.reload();
					} else {
						toastr.error("删除失败!", "错误");
						bootbox.alert("删除失败！信息：未知的错误发生了，请稍后重试，或联系管理员处理！");
					}
				}, "text");
			}
		});
	}

	function updCollage(id) {
		openBlock();
		$.post("getCollege.do", {
			"id" : id
		}, function(data) {
			closeBlock();
			if (data != "error") {
				collegeid = id;
				$("#ename").val(data.name);
				$('#editecollege').modal('show');
			} else {
				bootbox.alert("操作失败,请稍后再试!");
			}
		}, "json");
	}

	function editcollege() {
		$('#editecollege').modal('hide');
		openBlock();
		var name = $("#ename").val();
		$.post("editcollege.do", {
			"id" : collegeid,
			"name" : name
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable1.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	
	
	function addmajor() {
		$('#addMajor').modal('hide');
		var name = $("#mname").val();
		openBlock();
		$.post("addmajor.do", {
			"id" : collegeid,
			"name" : name
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable2.ajax.reload();
				$("#mname").val("");
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
	function updmajor(id){
		openBlock();
		majorid=id;
		$.post("getMajorOne.do", {
			"id" : id
		}, function(data) {
			closeBlock();
			if (data != "error") {
				$("#updmname").val(data.name);
				$('#updMajor').modal('show');
			} else {
				bootbox.alert("操作失败,请稍后再试!");
			}
		}, "json");
	}
	function delmajor(id){
		bootbox.confirm("您确定要删除该专业吗?", function(result) {
			if (result == true) {
				$.post("delMajor.do", {
					"id" : id
				}, function(data) {
					if (data == "ok") {
						toastr.success("删除成功!", "成功");
						oTable2.ajax.reload();
					} else {
						toastr.error("删除失败!", "错误");
						bootbox.alert("删除失败！信息：未知的错误发生了，请稍后重试，或联系管理员处理！");
					}
				}, "text");
			}
		});
	}
	function updSmajor(){
		$('#updMajor').modal('hide');
		openBlock();
		var name = $("#updmname").val();
		$.post("editMajor.do", {
			"id" : majorid,
			"name" : name
		}, function(data) {
			closeBlock();
			if (data == "ok") {
				toastr.success("操作成功!", "成功");
				oTable2.ajax.reload();
			} else {
				toastr.error("操作失败!", "错误");
				bootbox.alert("操作失败！信息：" + data);
			}
		}, "text");
	}
</script>
<@m.end/>
